<div class="product-detail-page container my-4">

  <div class="row g-4">

    <!-- LEFT : IMAGES -->
    <div class="col-md-6">
      <div class="image-section">
        <img [src]="selectedImage" class="main-img" alt="{{ product.name }}" />

        <div class="thumbnail-strip">
          <img *ngFor="let img of product.images" [src]="img.image" [class.active]="img.image === selectedImage"
            (click)="selectedImage = img.image" />
        </div>
      </div>
    </div>

    <!-- RIGHT : DETAILS -->
    <div class="col-md-6 product-info-section">

      <!-- TITLE -->
      <h1 class="product-title">{{ product.name }}</h1>

      <!-- BRAND / SELLER -->
      <div class="vendor-info">
        <span class="vendor-name">{{ product.shop.name }}</span>
        <span class="dot">•</span>
        <span class="vendor-address">{{ product.shop.address }}</span>
      </div>

      

      <!-- PRICE -->
      <div class="price-row mt-2">
        <span class="price">₹{{ product.final_price }}</span>
        <del *ngIf="product.discount_value">₹{{ product.price }}</del>
        <span class="unit">{{ product.unit.code }}</span>

        <span *ngIf="product.discount_value" class="discount-pill">
          SAVE {{ product.discount_type === 'percentage'
          ? (product.discount_value | number:'1.0-0') + '%'
          : '₹' + (product.discount_value | number:'1.0-0')
          }}
        </span>
      </div>

      <!-- DELIVERY INFO -->
      <div class="delivery-box">
        <img src="assets/undraw/delivery.svg" alt="Fast Delivery" />

        <div class="delivery-text">
          <strong>Delivery in 5–10 mins</strong>
          <span>Fresh stock from nearby store</span>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="product-actions mt-3">
        <!-- SAME CART LOGIC -->
        <div class="cart-action">
          <button class="btn-add" [class.hidden]="product.qty" (click)="addToCart(product); product.qty = 1">
            ADD
          </button>

          <div class="qty-box" [class.visible]="product.qty">
            <button (click)="decreaseQty(product)">−</button>
            <span>{{ product.qty }}</span>
            <button (click)="increaseQty(product)">+</button>
          </div>
        </div>

        <button class="btn-subscribe" (click)="openSubscribeModal(product)">
          Subscribe
        </button>
      </div>

      

      <!-- HIGHLIGHTS -->
      <div class="product-highlights">
        <h6>Why you’ll love this</h6>
        <!-- TRUST BADGES -->
      <div class="trust-badges">
        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/verified.svg" alt="Authentic" />
          </div>
          <span>100% Authentic</span>
        </div>

        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/quality.svg" alt="Quality Checked" />
          </div>
          <span>Quality Checked</span>
        </div>

        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/store.svg" alt="Local Vendor" />
          </div>
          <span>Local Vendor</span>
        </div>

        <!-- <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/replace.svg" alt="Exchange" />
          </div>
          <span>2 Days Exchange</span>
        </div> -->

        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/check_1.svg" alt="Exchange" />
          </div>
          <span>Fresh & locally sourced</span>
        </div>
        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/check_2.svg" alt="Exchange" />
          </div>
          <span>No middlemen pricing</span>
        </div>

        <div class="trust-card">
          <div class="icon-wrap">
            <img src="assets/undraw/check_3.svg" alt="Exchange" />
          </div>
          <span>Fast doorstep delivery</span>
        </div>
      </div>


        <!-- <ul>
          <li>
            <img src="assets/undraw/check_1.svg" />
            Fresh & locally sourced
          </li>
          <li>
            <img src="assets/undraw/check_2.svg" />
            No middlemen pricing
          </li>
          <li>
            <img src="assets/undraw/check_3.svg" />
            Fast doorstep delivery
          </li>
        </ul> -->
      </div>


      <div class="product-description-box mt-4">
        <h5>Product Details</h5>
        <p>{{ product.description }}</p>
      </div>
      <div class="info-strip">
        <div class="info-card">
          <img src="assets/undraw/shield.svg" />
          <div>
            <strong>Quality Assurance</strong>
            <span>Checked before delivery</span>
          </div>
        </div>

        <div class="info-card">
          <img src="assets/undraw/replace.svg" />
          <div>
            <strong>Easy Replacement</strong>
            <span>Hassle-free support</span>
          </div>
        </div>

        <div class="info-card">
          <img src="assets/undraw/location.svg" />
          <div>
            <strong>Nearby Store</strong>
            <span>Supports local vendors</span>
          </div>
        </div>
      </div>

    </div>


  </div>

  <!-- RELATED PRODUCTS -->
  <div class="related-products mt-5">
    <h5 class="section-title">Related Products</h5>

    <div class="related-scroll">
      <div *ngFor="let item of relatedProducts" class="product-card related-card">

        <a [routerLink]="['/product', item.slug]">

          <!-- DISCOUNT -->
          <div *ngIf="item.discount_value" class="discount-badge">
            {{ item.discount_type === 'percentage'
            ? (item.discount_value | number:'1.0-0') + '% OFF'
            : '₹' + (item.discount_value | number:'1.0-0') + ' OFF'
            }}
          </div>

          <!-- IMAGE -->
          <img [src]="item.image || 'assets/images/no-image.jpg'" class="product-img" />

          <!-- INFO -->
          <div class="product-info">
            <h6 class="product-title">{{ item.name }}</h6>

            <div class="price-row">
              <span class="price">₹{{ item.final_price }}</span>
              <del *ngIf="item.discount_value">₹{{ item.price }}</del>
              <span class="unit">{{ item.unit.code }}</span>
            </div>
          </div>
        </a>

        <!-- ACTIONS (same contract) -->
        <div class="product-actions">

          <div class="cart-action">
            <button class="btn-add" [class.hidden]="item.qty"
              (click)="addToCart(item); item.qty = 1; $event.stopPropagation()">
              ADD
            </button>

            <div class="qty-box" [class.visible]="item.qty">
              <button (click)="decreaseQty(item)">−</button>
              <span>{{ item.qty }}</span>
              <button (click)="increaseQty(item)">+</button>
            </div>
          </div>

          <button class="btn-subscribe" (click)="openSubscribeModal(item)">
            Subscribe
          </button>

        </div>

      </div>
    </div>
  </div>


</div>


<ng-template #subscribeModal let-modal>
  <div class="subscribe-modal">

    <!-- HEADER -->
    <div class="subscribe-header">
      <h5>Subscribe to Product</h5>
      <button class="close-btn" (click)="modal.dismiss()">×</button>
    </div>

    <!-- PRODUCT INFO -->
    <div class="subscribe-product">
      <img [src]="selectedProduct?.image || 'assets/images/no-image.jpg'" alt="Product Image" />

      <div class="product-meta">
        <div class="product-name">
          {{ selectedProduct?.name }}
          <span class="unit">({{ selectedProduct?.unit.code }})</span>
        </div>
        <div class="price">₹{{ selectedProduct?.final_price }}</div>
      </div>

      <!-- QTY -->
      <div class="quantity-box-sub">
        <button (click)="decreaseQty(selectedProduct)">−</button>
        <input class="sub-input" type="number" [(ngModel)]="selectedProduct.qty"
          (ngModelChange)="selectedProduct.qty = selectedProduct.qty < 1 ? 1 : selectedProduct.qty" min="1" readonly />
        <button (click)="increaseQty(selectedProduct)">+</button>
      </div>
    </div>

    <!-- OPTIONS -->
    <div class="subscribe-options">

      <div class="form-floating">
        <select class="form-select" [(ngModel)]="subscriptionPlan" id="subscription-select">
          <option value="daily">Daily</option>
          <option value="alternate_day">Alternate Day</option>
          <option value="every_3_days">Every 3 Days</option>
          <option value="weekly">Weekly</option>
          <option value="biweekly">Biweekly</option>
          <option value="monthly">Monthly</option>
        </select>
        <label for="subscription-select">Delivery Schedule</label>
      </div>

      <div class="form-floating">
        <input type="date" [(ngModel)]="startDate" class="form-control" id="schedule-date" />
        <label for="schedule-date">Start Date</label>
      </div>

    </div>

    <!-- TERMS -->
    <div class="subscribe-terms">
      <label>Terms & Conditions</label>
      <p>
        • Cancel or reschedule anytime<br />
        • Minimum 7-day commitment<br />
        • Delivery paused on public holidays
      </p>
    </div>

    <!-- FOOTER -->
    <div class="subscribe-footer">
      <button class="btn cancel" (click)="modal.dismiss()">Cancel</button>
      <button class="btn confirm" (click)="confirmSubscription()">
        Confirm Subscription
      </button>
    </div>

  </div>
</ng-template>