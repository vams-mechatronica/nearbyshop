<header class="zepto-header">

  <div class="header-container">

    <!-- LEFT : BRAND + LOCATION -->
    <div class="header-left">

      <a class="navbar-brand" [routerLink]="['/']" (click)="onNavClick()">The<span
          class="brand-span">NearBy</span>Shop<span class="brand-com">.com</span></a>

      <div class="location-select" (click)="openLocationModal()">

        <!-- ADDRESS LINE -->
        <div class="delivery-address" *ngIf="selectedLocationName; else selectLoc">
          <span class="sector">
            {{ sectorName }}
          </span>
          <span class="address-rest">
            {{ addressRest }}
          </span>
          <i class="fas fa-chevron-down chevron"></i>
        </div>

        <!-- FALLBACK -->
        <ng-template #selectLoc>
          <div class="delivery-address">
            <span class="sector muted">Select location</span>
            <i class="fas fa-chevron-down chevron"></i>
          </div>
        </ng-template>

      </div>


    </div>

    <!-- CENTER : SEARCH -->
    <div class="header-center">
      <div class="search-bar">

        <i class="fas fa-search search-icon"></i>

        <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange($event)" (keyup.enter)="onSearch()"
          placeholder="Search for products, brands & more" autocomplete="off" />

        <!-- SEARCH SUGGESTIONS -->
        <div class="search-suggestions" *ngIf="searchResults.length > 0">

          <div class="suggestion-item" *ngFor="let item of searchResults" (click)="selectResult(item)">

            <img [src]="item.image || 'assets/images/no-image.jpg'" />

            <div class="suggestion-text">
              <div class="name">{{ item.name }}</div>
              <div class="sub">{{ item.category_name }}</div>
            </div>

            <span class="cta">Shop</span>
          </div>

          <div class="show-all" (click)="onSearch()">
            Show all results for <strong>"{{ searchQuery }}"</strong>
            <i class="fas fa-chevron-right"></i>
          </div>

        </div>
      </div>
    </div>

    <!-- RIGHT : ACTIONS -->
    <!-- <div class="header-right">

      <a class="icon-btn" [routerLink]="['/subscribe']" (click)="onNavClick()">
        <i class="fas fa-box-open"></i>
        <span class="badge" *ngIf="subscriptionCount">{{ subscriptionCount }}</span>
      </a>

      <a class="icon-btn" [routerLink]="['/cart']" (click)="onNavClick()">
        <i class="fas fa-shopping-cart"></i>
        <span class="badge" *ngIf="cartCount">{{ cartCount }}</span>
      </a>
      <button class="login-btn" *ngIf="isBrowser && !(isLoggedIn$ | async)" (click)="loginSignup()">
        Login
      </button>

      <div class="profile profile-nav" *ngIf="isBrowser && (isLoggedIn$ | async)"
        (click)="toggleProfileDropdown($event)">
        <i class="fas fa-user-circle"></i>

        <div class="profile-dropdown" *ngIf="showProfileDropdown" (click)="$event.stopPropagation()">
          <div class="user-name">{{ userName }}</div>
          <a (click)="userProfile()">Profile</a>
          <a class="logout" (click)="logout()">Logout</a>
        </div>
      </div>


    </div> -->

    <div class="header-right">

      <!-- SUBSCRIPTIONS BUTTON -->
      <!-- <div class="subscription-wrapper">
        <a class="subscription-btn" [routerLink]="['/subscribe']" (click)="onNavClick()">
          <div class="subscription-icon">
            <i class="fas fa-box-open"></i>
            <span class="subscription-badge" *ngIf="subscriptionCount">{{ subscriptionCount }}</span>
          </div>
          <div class="subscription-text">
            <span class="subscription-label">Subscriptions</span>
            <span class="subscription-count" *ngIf="subscriptionCount > 0">{{ subscriptionCount }} active</span>
            <span class="subscription-count zero" *ngIf="subscriptionCount === 0">Add</span>
          </div>
        </a>
      </div> -->

      <!-- CART BUTTON -->
      <div class="cart-wrapper">
        <a class="cart-btn" [routerLink]="['/cart']" (click)="onNavClick()">
          <div class="cart-icon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-badge" *ngIf="cartCount">{{ cartCount }}</span>
          </div>
          <div class="cart-text">
            <span class="cart-label">Cart</span>
            <!-- <span class="cart-amount" *ngIf="cartTotal > 0">₹{{ cartTotal | number:'1.0-0' }}</span>
        <span class="cart-amount zero" *ngIf="cartTotal === 0">₹0</span> -->
          </div>
        </a>
      </div>

      <!-- LOGIN -->
      <button class="login-btn" *ngIf="isBrowser && !(isLoggedIn$ | async)" (click)="loginSignup()">
        Login
      </button>

      <!-- PROFILE -->
      <div class="profile profile-nav" *ngIf="isBrowser && (isLoggedIn$ | async)"
        (click)="toggleProfileDropdown($event)">
        <div class="profile-avatar">
          <i class="fas fa-user-circle"></i>
        </div>

        <div class="profile-dropdown" *ngIf="showProfileDropdown" (click)="$event.stopPropagation()">
          <div class="user-info">
            <div class="user-avatar">
              <i class="fas fa-user-circle"></i>
            </div>
            <div class="user-details">
              <div class="user-name">{{ userName }}</div>
              <!-- <div class="user-email">{{ userEmail }}</div> -->
            </div>
          </div>
          <div class="dropdown-divider"></div>
          <a (click)="userProfile()">
            <i class="fas fa-user"></i>
            <span>Profile</span>
          </a>
          <!-- <a (click)="goToOrders()">
                <i class="fas fa-shopping-bag"></i>
                <span>My Orders</span>
              </a>
              <a (click)="goToAddresses()">
                <i class="fas fa-map-marker-alt"></i>
                <span>Saved Addresses</span>
              </a>
              <a (click)="goToSubscriptions()">
                <i class="fas fa-box-open"></i>
                <span>My Subscriptions</span>
              </a> -->
          <div class="dropdown-divider"></div>
          <a class="logout" (click)="logout()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
          </a>
        </div>
      </div>

    </div>

  </div>

</header>

<ng-template #locationModal let-modal>
  <div class="location-modal">
    <div class="modal-header">
      <h5>Your Location</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <!-- <input type="text" class="form-control location-search" placeholder="Search a new address"
        [(ngModel)]="locationSearch" /> -->

      <input type="text" class="form-control location-search" placeholder="Search a new address"
        [(ngModel)]="locationSearch" (input)="handleLocationSearch()" />

      <div class="use-location-card">
        <div class="use-location-icon">
          <i class="fas fa-crosshairs text-danger"></i>
        </div>
        <div class="use-location-text">
          <h6>Use My Current Location</h6>
          <p>Enable your current location for better services</p>
        </div>
        <button class="btn btn-outline-danger" (click)="useCurrentLocation(modal)">Enable</button>
      </div>

      <div class="map-placeholder">
        <img src="assets/images/location_illustration.png" alt="Location Illustration" />
      </div>
    </div>
  </div>
</ng-template>