<header class="zepto-header">

  <div class="header-container">

    <!-- LEFT : BRAND + LOCATION -->
    <div class="header-left">

      <a class="navbar-brand" [routerLink]="['/']" (click)="onNavClick()">The<span
          class="brand-span">NearBy</span>Shop<span class="brand-com">.com</span></a>

      <div class="location-select" (click)="openLocationModal()">

        <!-- ADDRESS LINE -->
        <div class="delivery-address" *ngIf="selectedLocationName; else selectLoc">
          <span class="sector">
            {{ sectorName }}
          </span>
          <span class="address-rest">
            {{ addressRest }}
          </span>
          <i class="fas fa-chevron-down chevron"></i>
        </div>

        <!-- FALLBACK -->
        <ng-template #selectLoc>
          <div class="delivery-address">
            <span class="sector muted">Select location</span>
            <i class="fas fa-chevron-down chevron"></i>
          </div>
        </ng-template>

      </div>


    </div>

    <!-- CENTER : SEARCH -->
    <div class="header-center">
      <div class="search-bar">

        <i class="fas fa-search search-icon"></i>

        <input type="text" [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange($event)" (keyup.enter)="onSearch()"
          placeholder="Search for products, brands & more" autocomplete="off" />

        <!-- SEARCH SUGGESTIONS -->
        <div class="search-suggestions" *ngIf="searchResults.length > 0">

          <div class="suggestion-item" *ngFor="let item of searchResults" (click)="selectResult(item)">

            <img [src]="item.image" />

            <div class="suggestion-text">
              <div class="name">{{ item.name }}</div>
              <div class="sub">{{ item.category_name }}</div>
            </div>

            <span class="cta">Shop</span>
          </div>

          <div class="show-all" (click)="onSearch()">
            Show all results for <strong>"{{ searchQuery }}"</strong>
            <i class="fas fa-chevron-right"></i>
          </div>

        </div>
      </div>
    </div>

    <!-- RIGHT : ACTIONS -->
    <div class="header-right">

      <a class="icon-btn" [routerLink]="['/subscribe']" (click)="onNavClick()">
        <i class="fas fa-box-open"></i>
        <span class="badge" *ngIf="subscriptionCount">{{ subscriptionCount }}</span>
      </a>

      <a class="icon-btn" [routerLink]="['/cart']" (click)="onNavClick()">
        <i class="fas fa-shopping-cart"></i>
        <span class="badge" *ngIf="cartCount">{{ cartCount }}</span>
      </a>

      <!-- LOGIN -->
      <button class="login-btn" *ngIf="isBrowser && !(isLoggedIn$ | async)" (click)="loginSignup()">
        Login
      </button>

      <!-- PROFILE -->
      <div class="profile profile-nav" *ngIf="isBrowser && (isLoggedIn$ | async)" (click)="toggleProfileDropdown($event)">
        <i class="fas fa-user-circle"></i>

        <div class="profile-dropdown" *ngIf="showProfileDropdown" (click)="$event.stopPropagation()">
          <div class="user-name">{{ userName }}</div>
          <a (click)="userProfile()">Profile</a>
          <a class="logout" (click)="logout()">Logout</a>
        </div>
      </div>


    </div>

  </div>

</header>

<ng-template #locationModal let-modal>
  <div class="location-modal">
    <div class="modal-header">
      <h5>Your Location</h5>
      <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
      <input type="text" class="form-control location-search" placeholder="Search a new address"
        [(ngModel)]="locationSearch" />

      <div class="use-location-card">
        <div class="use-location-icon">
          <i class="fas fa-crosshairs text-danger"></i>
        </div>
        <div class="use-location-text">
          <h6>Use My Current Location</h6>
          <p>Enable your current location for better services</p>
        </div>
        <button class="btn btn-outline-danger" (click)="useCurrentLocation(modal)">Enable</button>
      </div>

      <div class="map-placeholder">
        <img src="assets/images/location_illustration.png" alt="Location Illustration" />
      </div>
    </div>
  </div>
</ng-template>