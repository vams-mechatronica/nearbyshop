<div class="container-body">
    <div class="shop-page">

        <!-- BREADCRUMBS -->
        <nav class="breadcrumbs">
            <span routerLink="/">Home</span>
            <span>/</span>
            <span routerLink="/stores">Stores</span>
            <span>/</span>
            <span class="active">{{ categoryName || 'Products' }}</span>
        </nav>

        <!-- CONTENT -->
        <div class="shop-layout">

            <!-- LEFT SIDEBAR : CATEGORIES -->
            <aside class="category-sidebar">
                <h6 class="sidebar-title">Categories</h6>

                <ul class="category-list">
                    <li *ngFor="let category of categories" (click)="onCategoryChange(category.slug)"
                        [class.active]="category.slug === selectedCategory">
                        <span>{{ category.name }}</span>
                        <small>{{ category.count }}</small>
                    </li>
                </ul>
            </aside>

            <!-- MAIN CONTENT -->
            <div class="shop-main">

                <!-- VENDOR STRIP -->
                <section class="vendor-strip">
                    <div class="vendor-card" *ngFor="let store of stores" (click)="selectStore(store)"
                        [class.active]="store.id === selectedStoreId">
                        <img [src]="store.shop_image" />
                        <span>{{ store.shop_name }}</span>
                    </div>
                </section>

                <!-- PRODUCTS -->
                <section class="product-area" #productScroller (scroll)="onProductScroll()">

                    <!-- LOADER -->
                    <div class="loader" *ngIf="isLoading">
                        <div class="spinner-border text-danger"></div>
                    </div>

                    <!-- PRODUCT GRID -->
                    <div class="product-grid" *ngIf="products.length; else noProducts">

                        <div class="product-card" *ngFor="let product of products"
                            [class.vendor-closed]="!product.vendor?.is_accepting_orders">

                            <a [routerLink]="['/product', product.slug]">

                                <!-- DISCOUNT -->
                                <div *ngIf="product.discount_value > 0" class="discount">
                                    <ng-container *ngIf="product.discount_type === 'percentage'; else flatDiscount">
                                        {{ product.discount_value | number:'1.0-0'}}% OFF
                                    </ng-container>

                                    <ng-template #flatDiscount>
                                        ₹{{ product.discount_value | number:'1.0-0'}} OFF
                                    </ng-template>
                                </div>


                                <!-- IMAGE -->
                                <img [src]="product.image" class="product-img" />

                                <!-- INFO -->
                                <div class="product-info">

                                    <h6 class="product-name">{{ product.name }}</h6>

                                    <!-- VENDOR INFO -->
                                    <div class="vendor-info">
                                        <div class="vendor-name">
                                            {{ product.vendor?.shop_name }}
                                        </div>

                                        <div class="vendor-address">
                                            {{ product.vendor?.shop_address }}
                                        </div>

                                        <div class="vendor-status" *ngIf="!product.vendor?.is_accepting_orders">
                                            Not accepting orders
                                        </div>
                                    </div>

                                    <!-- PRICE -->
                                    <div class="price-row">
                                        <span class="price">₹{{ product.final_price }}</span>
                                        <del *ngIf="product.discount_value">₹{{ product.price }}</del>
                                    </div>

                                </div>
                            </a>

                            <!-- ACTIONS -->
                            <div class="product-actions">

                                <button class="btn-add" [disabled]="!product.vendor?.is_accepting_orders" *ngIf="!product.qty"
                                    (click)="addToCart(product)">
                                    ADD
                                </button>

                                <!-- QTY -->
                                <div *ngIf="product.qty" class="qty-box">
                                    <button (click)="decreaseQty(product)">−</button>
                                    <span>{{ product.qty }}</span>
                                    <button (click)="increaseQty(product)">+</button>
                                </div>


                                <button class="btn-subscribe" (click)="openSubscribeModal(product)">
                                    Subscribe
                                </button>

                            </div>

                        </div>
                    </div>


                    <!-- NO PRODUCTS -->
                    <ng-template #noProducts>
                        <div class="empty">
                            No products found
                        </div>
                    </ng-template>

                </section>

            </div>
        </div>
    </div>
</div>