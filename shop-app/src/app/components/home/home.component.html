<div class="zepto-home">

  <!-- CATEGORY STRIP -->
  <section class="category-strip">
    <div class="category-item" *ngFor="let cat of categories" (click)="selectCategory(cat)">
      <div class="category-img">
        <img [src]="cat.image" alt="{{ cat.name }}" />
      </div>
      <div class="category-label">
        {{ cat.name }}
      </div>
    </div>
  </section>


  <!-- OFFER BANNERS -->
  <section class="offer-section">
    <div class="offer-card primary">
      <h3>₹0 Convenience Fee</h3>
      <p>On all nearby shop orders</p>
      <button>Order now</button>
    </div>

    <div class="offer-card secondary">
      <h3>Lowest Prices Everyday</h3>
      <p>No surge, no rain fee</p>
    </div>
  </section>

  <section class="section" *ngFor="let shelf of categoryShelves; let i = index">

  <!-- HEADER -->
  <div class="section-header">
    <h2>{{ shelf.categoryName }}</h2>
    <span
      class="view-all"
      *ngIf="shelf.products?.length"
      [routerLink]="['/category', shelf.categorySlug]"
    >
      View all
    </span>
  </div>

  <!-- PRODUCTS / EMPTY STATE -->
  <ng-container *ngIf="shelf.products?.length; else noProducts">

    <!-- PRODUCT CAROUSEL -->
    <div class="horizontal-scroll"
         (scroll)="onHorizontalScroll($event, shelf.categorySlug)">

      <div class="product-carousel-wrapper">

        <div class="product-row" #carousel>

          <a class="product-card" *ngFor="let product of shelf.products">

            <div class="image-wrapper">
              <img [src]="product.image" alt="{{ product.name }}" />
              <button
                class="add-btn"
                (click)="$event.preventDefault(); addToCart(product)">
                ADD
              </button>
            </div>

            <div class="price-row">
              <span class="final-price">₹{{ product.final_price }}</span>
              <span class="mrp" *ngIf="product.discount_value">
                ₹{{ product.price }}
              </span>
            </div>

            <div class="discount-text" *ngIf="product.discount_value">
              ₹{{ product.price - product.final_price }} OFF
            </div>

            <div class="product-name"
                 [routerLink]="['/product', product.slug]">
              {{ product.name }}
            </div>

            <div class="pack-info">
              {{ product.unit?.code || '1 pack' }}
            </div>

            <div class="tag-chip">
              {{ product.vendor?.shop_name }}
            </div>

            <div class="rating-row">
              <span class="rating">⭐ {{ product.rating || 4.9 }}</span>
              <span class="dot">•</span>
              <span class="time">7 mins</span>
            </div>

          </a>

          <!-- LOADER -->
          <div class="product-skeleton" *ngIf="shelf.loading"></div>

        </div>

        <button
          class="carousel-arrow"
          (click)="scrollRight(carousel, shelf.categorySlug)">
          ›
        </button>

      </div>
    </div>

  </ng-container>

  <!-- NO PRODUCTS TEMPLATE -->
  <ng-template #noProducts>
    <div class="no-products">
      <p>No products available</p>
    </div>
  </ng-template>

  <!-- VERTICAL LAZY LOAD TRIGGER -->
  <div
    class="vertical-loader"
    *ngIf="i === categoryShelves.length - 1"
    appIntersectionObserver
    (visible)="loadNextCategoryShelf()">
  </div>

</section>



  <!-- STORES -->
  <section class="section">
    <div class="section-header">
      <h2>Popular Stores Near You</h2>
      <span class="view-all" [routerLink]="['/stores/all']">View all</span>
    </div>

    <div class="store-carousel">
      <div class="store-row">
        <div class="store-card" *ngFor="let store of stores" (click)="selectStore(store)">
          <div class="store-img">
            <img [src]="store.shop_image" alt="{{ store.name }}" />
          </div>

          <div class="store-name">
            {{ store.name }}
          </div>
          
          <!-- RATING ROW -->
          <div class="vendor-rating">
            <i class="fas fa-star"></i>
            <span class="rating-value">{{ store.rating || 4.9 }}</span>
            <span class="dot">•</span>
            <span class="time">{{ store.delivery_time || '7 mins' }}</span>
          </div>
          
          <!-- VENDOR CATEGORY PILL -->
          <div class="vendor-category-pill">
            {{ store.category_name || 'Cafe' }}
          </div>
        </div>
      </div>
    </div>

  </section>

  <!-- PROMO BANNERS -->
  <section class="promo-section">
    <div class="promo-card" *ngFor="let banner of processedBanners">
      <img [src]="banner.image" />
    </div>
  </section>

</div>